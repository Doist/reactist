{"version":3,"file":"dropdown.js","sources":["../../../src/components/deprecated-dropdown/dropdown.tsx"],"sourcesContent":["import * as React from 'react'\nimport ReactDOM from 'react-dom'\nimport classNames from 'classnames'\n\nimport Button from '../deprecated-button'\n\nimport './dropdown.less'\n\ntype BoxProps = {\n    onShowBody?: () => void\n    onHideBody?: () => void\n    allowBodyInteractions?: boolean\n    top?: boolean\n    right?: boolean\n    scrolling_parent?: string\n    children?: [\n        React.ReactElement<TriggerProps>,\n        React.ReactElement<BodyProps> | ((props: BodyProps) => JSX.Element),\n    ]\n    className?: string\n}\n\ntype BoxState = {\n    top: boolean\n    showBody: boolean\n}\n\nclass Box extends React.Component<BoxProps, BoxState> {\n    public static displayName: string\n\n    constructor(props: BoxProps, context: React.Context<unknown>) {\n        super(props, context)\n        this.state = {\n            showBody: false,\n            top: props.top || false,\n        }\n\n        this._timeout = undefined\n    }\n\n    componentWillUnmount() {\n        document.removeEventListener('click', this._handleClickOutside, true)\n        if (this._timeout) {\n            clearTimeout(this._timeout)\n        }\n    }\n    _timeout?: ReturnType<typeof setTimeout>\n\n    _handleClickOutside = (event: MouseEvent) => {\n        const dropdownDOMNode = ReactDOM.findDOMNode(this)\n\n        if (dropdownDOMNode && !dropdownDOMNode.contains(event.target as Node))\n            this._toggleShowBody()\n        else if (!this.props.allowBodyInteractions) {\n            // won't close when body interactions are allowed\n            this._timeout = setTimeout(() => {\n                if (this.state.showBody) {\n                    this._toggleShowBody()\n                }\n            }, 100)\n        }\n    }\n\n    _toggleShowBody = () => {\n        if (!this.state.showBody) {\n            // will show\n            if (this.props.onShowBody) this.props.onShowBody()\n            document.addEventListener('click', this._handleClickOutside, true)\n        } else {\n            // will hide\n            if (this.props.onHideBody) this.props.onHideBody()\n            document.removeEventListener('click', this._handleClickOutside, true)\n        }\n\n        this.setState({\n            showBody: !this.state.showBody,\n        })\n    }\n\n    _getTriggerComponent() {\n        const _trigger = this.props.children?.[0]\n        return _trigger\n            ? React.cloneElement(_trigger, { onClick: this._toggleShowBody })\n            : undefined\n    }\n\n    // https://facebook.github.io/react/docs/refs-and-the-dom.html#exposing-dom-refs-to-parent-components\n    _setPosition = (body: HTMLElement | null) => {\n        if (body) {\n            const scrollingParent = document.getElementById(\n                this.props.scrolling_parent ? this.props.scrolling_parent : '',\n            )\n\n            if (scrollingParent) {\n                const dropdown = ReactDOM.findDOMNode(this)\n                if (!dropdown) {\n                    return\n                }\n                const dropdownVerticalPosition = (ReactDOM.findDOMNode(this) as HTMLElement)\n                    .offsetTop\n                const dropdownTrigger = (dropdown as Element).querySelector('.trigger')\n                if (!dropdownTrigger) {\n                    return\n                }\n                const dropdownTriggerHeight = dropdownTrigger.clientHeight\n                const dropdownBodyHeight = body.clientHeight\n\n                const scrollingParentHeight = scrollingParent.clientHeight\n                const scrollingParentOffset = scrollingParent.scrollTop\n\n                const bottomOffset =\n                    scrollingParentHeight +\n                    scrollingParentOffset -\n                    dropdownVerticalPosition -\n                    dropdownTriggerHeight\n\n                const top = bottomOffset < dropdownBodyHeight\n\n                if (top !== this.state.top) {\n                    this.setState({ top })\n                }\n            }\n        }\n    }\n\n    _getBodyComponent() {\n        if (!this.state.showBody) {\n            return null\n        }\n        const { top } = this.state\n        const { right = false, children } = this.props\n        const props = { top, right, setPosition: this._setPosition }\n\n        const className = classNames({\n            body_wrapper: true,\n            with_arrow: true,\n            top: top,\n            bottom: !top,\n        })\n\n        const body = children?.[1]\n\n        const contentMarkup =\n            typeof body === 'function'\n                ? body(props)\n                : body\n                ? React.cloneElement(body, props)\n                : undefined\n        return (\n            <div className={className} style={{ position: 'relative' }}>\n                {contentMarkup}\n            </div>\n        )\n    }\n\n    render() {\n        const className = classNames('reactist_dropdown', this.props.className)\n        const { top } = this.state\n\n        return (\n            <div\n                style={{ display: 'inline-block' }}\n                className={className}\n                data-testid=\"reactist-dropdown-box\"\n            >\n                {top && this._getBodyComponent()}\n                {this._getTriggerComponent()}\n                {!top && this._getBodyComponent()}\n            </div>\n        )\n    }\n}\n\nBox.displayName = 'Dropdown.Box'\n\ntype NativeButtonProps = React.DetailedHTMLProps<\n    React.ButtonHTMLAttributes<HTMLButtonElement>,\n    HTMLButtonElement\n>\n\ntype TriggerProps = Omit<NativeButtonProps, 'title' | 'onClick'> & {\n    tooltip?: React.ReactNode\n    /**\n     * @private the onClick prop is not to be used externally\n     */\n    onClick?: NativeButtonProps['onClick']\n}\n\nconst Trigger = React.forwardRef<HTMLButtonElement, TriggerProps>(function Trigger(\n    { children, onClick, tooltip, className, ...props },\n    ref,\n) {\n    function handleClick(event: React.MouseEvent<HTMLButtonElement, MouseEvent>) {\n        event.preventDefault()\n        event.stopPropagation()\n        if (onClick) onClick(event)\n    }\n\n    return (\n        <Button\n            {...props}\n            className={classNames('trigger', className)}\n            onClick={handleClick}\n            tooltip={tooltip}\n            ref={ref}\n        >\n            {children}\n        </Button>\n    )\n})\n\nTrigger.displayName = 'Dropdown.Trigger'\n\ntype BodyProps = {\n    setPosition?: React.Ref<HTMLDivElement>\n    children?: React.ReactNode\n    top?: boolean\n    right?: boolean\n}\n\nfunction Body({ top, right, children, setPosition }: BodyProps) {\n    const style: React.CSSProperties = { position: 'absolute', right: 0, top: 0 }\n\n    if (top) {\n        style.top = 'auto'\n        style.bottom = 0\n    }\n\n    if (right) {\n        style.right = 'auto'\n        style.left = 0\n    }\n\n    return (\n        <div\n            ref={setPosition}\n            style={style}\n            className=\"body\"\n            id=\"reactist-dropdown-body\"\n            data-testid=\"reactist-dropdown-body\"\n        >\n            {children}\n        </div>\n    )\n}\n\nBody.displayName = 'Dropdown.Body'\n\nconst Dropdown = {\n    Box,\n    Trigger,\n    Body,\n}\n\nexport { Dropdown }\n"],"names":["Box","React","Component","constructor","props","context","super","this","_timeout","_handleClickOutside","event","dropdownDOMNode","ReactDOM","findDOMNode","contains","target","_toggleShowBody","allowBodyInteractions","setTimeout","state","showBody","onHideBody","document","removeEventListener","onShowBody","addEventListener","setState","_setPosition","body","scrollingParent","getElementById","scrolling_parent","dropdown","dropdownVerticalPosition","offsetTop","dropdownTrigger","querySelector","top","clientHeight","scrollTop","undefined","componentWillUnmount","clearTimeout","_getTriggerComponent","_this$props$children","_trigger","children","cloneElement","onClick","_getBodyComponent","right","setPosition","className","classNames","body_wrapper","with_arrow","bottom","contentMarkup","createElement","style","position","render","display","displayName","Trigger","forwardRef","ref","tooltip","_ref","_objectWithoutProperties","objectWithoutProperties","_excluded","Button","preventDefault","stopPropagation","Body","left","id","data-testid"],"mappings":"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"}