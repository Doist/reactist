{"version":3,"file":"dropdown.js","sources":["../../../src/components/deprecated-dropdown/dropdown.tsx"],"sourcesContent":["import * as React from 'react'\nimport ReactDOM from 'react-dom'\nimport classNames from 'classnames'\n\nimport Button from '../deprecated-button'\n\nimport './dropdown.less'\n\ntype BoxProps = {\n    onShowBody?: () => void\n    onHideBody?: () => void\n    allowBodyInteractions?: boolean\n    top?: boolean\n    right?: boolean\n    scrolling_parent?: string\n    children?: [\n        React.ReactElement<TriggerProps>,\n        React.ReactElement<BodyProps> | ((props: BodyProps) => JSX.Element),\n    ]\n    className?: string\n}\n\ntype BoxState = {\n    top: boolean\n    showBody: boolean\n}\n\nclass Box extends React.Component<BoxProps, BoxState> {\n    public static displayName: string\n\n    constructor(props: BoxProps, context: React.Context<unknown>) {\n        super(props, context)\n        this.state = {\n            showBody: false,\n            top: props.top || false,\n        }\n\n        this._timeout = undefined\n    }\n\n    componentWillUnmount() {\n        document.removeEventListener('click', this._handleClickOutside, true)\n        if (this._timeout) {\n            clearTimeout(this._timeout)\n        }\n    }\n    _timeout?: ReturnType<typeof setTimeout>\n\n    _handleClickOutside = (event: MouseEvent) => {\n        const dropdownDOMNode = ReactDOM.findDOMNode(this)\n\n        if (dropdownDOMNode && !dropdownDOMNode.contains(event.target as Node))\n            this._toggleShowBody()\n        else if (!this.props.allowBodyInteractions) {\n            // won't close when body interactions are allowed\n            this._timeout = setTimeout(() => {\n                if (this.state.showBody) {\n                    this._toggleShowBody()\n                }\n            }, 100)\n        }\n    }\n\n    _toggleShowBody = () => {\n        if (!this.state.showBody) {\n            // will show\n            if (this.props.onShowBody) this.props.onShowBody()\n            document.addEventListener('click', this._handleClickOutside, true)\n        } else {\n            // will hide\n            if (this.props.onHideBody) this.props.onHideBody()\n            document.removeEventListener('click', this._handleClickOutside, true)\n        }\n\n        this.setState({\n            showBody: !this.state.showBody,\n        })\n    }\n\n    _getTriggerComponent() {\n        const _trigger = this.props.children?.[0]\n        return _trigger\n            ? React.cloneElement(_trigger, { onClick: this._toggleShowBody })\n            : undefined\n    }\n\n    // https://facebook.github.io/react/docs/refs-and-the-dom.html#exposing-dom-refs-to-parent-components\n    _setPosition = (body: HTMLElement | null) => {\n        if (body) {\n            const scrollingParent = document.getElementById(\n                this.props.scrolling_parent ? this.props.scrolling_parent : '',\n            )\n\n            if (scrollingParent) {\n                const dropdown = ReactDOM.findDOMNode(this)\n                if (!dropdown) {\n                    return\n                }\n                const dropdownVerticalPosition = (ReactDOM.findDOMNode(this) as HTMLElement)\n                    .offsetTop\n                const dropdownTrigger = (dropdown as Element).querySelector('.trigger')\n                if (!dropdownTrigger) {\n                    return\n                }\n                const dropdownTriggerHeight = dropdownTrigger.clientHeight\n                const dropdownBodyHeight = body.clientHeight\n\n                const scrollingParentHeight = scrollingParent.clientHeight\n                const scrollingParentOffset = scrollingParent.scrollTop\n\n                const bottomOffset =\n                    scrollingParentHeight +\n                    scrollingParentOffset -\n                    dropdownVerticalPosition -\n                    dropdownTriggerHeight\n\n                const top = bottomOffset < dropdownBodyHeight\n\n                if (top !== this.state.top) {\n                    this.setState({ top })\n                }\n            }\n        }\n    }\n\n    _getBodyComponent() {\n        if (!this.state.showBody) {\n            return null\n        }\n        const { top } = this.state\n        const { right = false, children } = this.props\n        const props = { top, right, setPosition: this._setPosition }\n\n        const className = classNames({\n            body_wrapper: true,\n            with_arrow: true,\n            top: top,\n            bottom: !top,\n        })\n\n        const body = children?.[1]\n\n        const contentMarkup =\n            typeof body === 'function'\n                ? body(props)\n                : body\n                ? React.cloneElement(body, props)\n                : undefined\n        return (\n            <div className={className} style={{ position: 'relative' }}>\n                {contentMarkup}\n            </div>\n        )\n    }\n\n    render() {\n        const className = classNames('reactist_dropdown', this.props.className)\n        const { top } = this.state\n\n        return (\n            <div\n                style={{ display: 'inline-block' }}\n                className={className}\n                data-testid=\"reactist-dropdown-box\"\n            >\n                {top && this._getBodyComponent()}\n                {this._getTriggerComponent()}\n                {!top && this._getBodyComponent()}\n            </div>\n        )\n    }\n}\n\nBox.displayName = 'Dropdown.Box'\n\ntype NativeButtonProps = React.DetailedHTMLProps<\n    React.ButtonHTMLAttributes<HTMLButtonElement>,\n    HTMLButtonElement\n>\n\ntype TriggerProps = Omit<NativeButtonProps, 'title' | 'onClick'> & {\n    tooltip?: React.ReactNode\n    /**\n     * @private the onClick prop is not to be used externally\n     */\n    onClick?: NativeButtonProps['onClick']\n}\n\nconst Trigger = React.forwardRef<HTMLButtonElement, TriggerProps>(function Trigger(\n    { children, onClick, tooltip, className, ...props },\n    ref,\n) {\n    function handleClick(event: React.MouseEvent<HTMLButtonElement, MouseEvent>) {\n        event.preventDefault()\n        event.stopPropagation()\n        if (onClick) onClick(event)\n    }\n\n    return (\n        <Button\n            {...props}\n            className={classNames('trigger', className)}\n            onClick={handleClick}\n            tooltip={tooltip}\n            ref={ref}\n        >\n            {children}\n        </Button>\n    )\n})\n\nTrigger.displayName = 'Dropdown.Trigger'\n\ntype BodyProps = {\n    setPosition?: React.Ref<HTMLDivElement>\n    children?: React.ReactNode\n    top?: boolean\n    right?: boolean\n}\n\nfunction Body({ top, right, children, setPosition }: BodyProps) {\n    const style: React.CSSProperties = { position: 'absolute', right: 0, top: 0 }\n\n    if (top) {\n        style.top = 'auto'\n        style.bottom = 0\n    }\n\n    if (right) {\n        style.right = 'auto'\n        style.left = 0\n    }\n\n    return (\n        <div\n            ref={setPosition}\n            style={style}\n            className=\"body\"\n            id=\"reactist-dropdown-body\"\n            data-testid=\"reactist-dropdown-body\"\n        >\n            {children}\n        </div>\n    )\n}\n\nBody.displayName = 'Dropdown.Body'\n\nconst Dropdown = {\n    Box,\n    Trigger,\n    Body,\n}\n\nexport { Dropdown }\n"],"names":["Box","React","Component","constructor","props","context","_timeout","_handleClickOutside","event","dropdownDOMNode","ReactDOM","findDOMNode","contains","target","_toggleShowBody","allowBodyInteractions","setTimeout","state","showBody","onShowBody","document","addEventListener","onHideBody","removeEventListener","setState","_setPosition","body","scrollingParent","getElementById","scrolling_parent","dropdown","dropdownVerticalPosition","offsetTop","dropdownTrigger","querySelector","dropdownTriggerHeight","clientHeight","dropdownBodyHeight","scrollingParentHeight","scrollingParentOffset","scrollTop","bottomOffset","top","undefined","componentWillUnmount","clearTimeout","_getTriggerComponent","_trigger","children","cloneElement","onClick","_getBodyComponent","right","setPosition","className","classNames","body_wrapper","with_arrow","bottom","contentMarkup","createElement","style","position","render","display","displayName","Trigger","forwardRef","ref","tooltip","handleClick","preventDefault","stopPropagation","Button","Body","left","id","Dropdown"],"mappings":"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"}