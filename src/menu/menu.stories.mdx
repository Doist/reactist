import { Meta, Story, Canvas, ArgsTable, Description } from '@storybook/addon-docs'
import KeyboardShortcut from '../components/keyboard-shortcut'
import { Button } from '../button'
import { Inline } from '../inline'
import { Stack } from '../stack'
import { Columns, Column } from '../columns'
import {
    ContextMenuTrigger,
    IconMenuItem,
    IconsMenuGroup,
    Menu,
    MenuButton,
    MenuList,
    MenuItem,
    MenuGroup,
    SubMenu,
    SubMenuItem,
    SubMenuList,
} from './menu'
import { ButtonLink } from '../button-link'
import { Text } from '../text'
import { Box } from '../box'
import { Avatar } from '../avatar'

<Meta
    title="Design system/Menu"
    component={Menu}
    parameters={{
        badges: ['accessible'],
    }}
/>

export function ArrowDown() {
    return (
        <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            viewBox="0 0 16 16"
        >
            <path
                fillRule="evenodd"
                d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"
            />
        </svg>
    )
}

export function ArrowRight() {
    return (
        <svg width="24" height="24">
            <path
                d="M14.243 12L9.646 7.404a.5.5 0 1 1 .708-.707l4.95 4.95a.5.5 0 0 1 0 .707l-4.95 4.95a.5.5 0 0 1-.708-.708L14.243 12z"
                fill="currentColor"
                fillRule="evenodd"
            />
        </svg>
    )
}

export function LeaveIcon() {
    return (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24">
            <g fill="none" fillRule="evenodd">
                <path
                    stroke="currentColor"
                    d="M6.5 8.3V5.63c0-1.17.9-2.13 2-2.13h7c1.1 0 2 .95 2 2.13v11.74c0 1.17-.9 2.13-2 2.13h-7c-1.1 0-2-.95-2-2.13V14.7"
                />
                <path
                    fill="currentColor"
                    d="M12.8 11l-2.15-2.15a.5.5 0 1 1 .7-.7L14 10.79a1 1 0 0 1 0 1.42l-2.65 2.64a.5.5 0 0 1-.7-.7L12.79 12H4.5a.5.5 0 0 1 0-1h8.3z"
                />
            </g>
        </svg>
    )
}

export function FlagIcon() {
    return (
        <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M4 5C4 4.83282 4.08355 4.67671 4.22265 4.58397C5.31288 3.85716 6.7415 3.5 8.5 3.5C9.61281 3.5 10.4206 3.6965 12.1581 4.27566C13.7956 4.8215 14.5295 5 15.5 5C17.0748 5 18.3129 4.69049 19.2226 4.08397C19.5549 3.86246 20 4.10065 20 4.5V13C20 13.1672 19.9164 13.3233 19.7774 13.416C18.6871 14.1428 17.2585 14.5 15.5 14.5C14.3872 14.5 13.5794 14.3035 11.8419 13.7243C10.2044 13.1785 9.47052 13 8.5 13C7.05006 13 5.88561 13.2624 5 13.7773V19.5C5 19.7761 4.77614 20 4.5 20C4.22386 20 4 19.7761 4 19.5V13.5V5.5V5ZM8.5 12C7.13251 12 5.96451 12.216 5 12.6538V5.27733C5.88561 4.76236 7.05006 4.5 8.5 4.5C9.47052 4.5 10.2044 4.6785 11.8419 5.22434C13.5794 5.8035 14.3872 6 15.5 6C16.8675 6 18.0355 5.78402 19 5.34617V12.7227C18.1144 13.2376 16.9499 13.5 15.5 13.5C14.5295 13.5 13.7956 13.3215 12.1581 12.7757C10.4206 12.1965 9.61281 12 8.5 12Z"
                fill="currentColor"
            />
        </svg>
    )
}

# Menu

A set of components that provide the means to construct a menu that can be triggered
via an element or as a context menu.

<Canvas>
    <Story
        name="Simple Menu Story"
        parameters={{
            docs: { source: { type: 'code' } },
        }}
    >
        <Menu>
            <MenuButton as={Button} variant="primary" endIcon={<ArrowDown />}>
                Simple menu
            </MenuButton>
            <MenuList aria-label="Simple menu">
                <MenuItem label="Edit" />
                <MenuItem label="Copy" />
                <MenuItem label="Paste" />
                <MenuItem label="Duplicate" />
                <hr />
                <MenuItem label="Remove" />
            </MenuList>
        </Menu>
    </Story>
</Canvas>

### `tooltip`

The `tooltip` prop allows a tooltip to be shown over the menu button.

<Canvas>
    <Story
        name="Tooltip Story"
        parameters={{
            docs: { source: { type: 'code' } },
        }}
    >
        <Menu>
            <MenuButton as={Button} variant="primary" tooltip="I have a tooltip">
                Focus on or hover over me
            </MenuButton>
            <MenuList aria-label="Tooltip menu">
                <MenuItem label="Edit" />
                <MenuItem label="Copy" />
                <MenuItem label="Paste" />
                <MenuItem label="Duplicate" />
                <MenuItem label="Remove" />
            </MenuList>
        </Menu>
    </Story>
</Canvas>

### `modal`

By default, interaction with elements below the menu is disallowed when the menu is open. This behaviour can
be changed by passing `modal={false}` to `<MenuList>`

<Canvas>
    <Story
        name="Outside Interaction Story"
        parameters={{
            docs: { source: { type: 'code' } },
        }}
    >
        <Menu>
            <MenuButton as={Button} variant="primary">
                Menu
            </MenuButton>
            <MenuList aria-label="Outside interaction menu" modal={false}>
                <MenuItem label="Edit" />
                <MenuItem label="Copy" />
                <MenuItem label="Paste" />
                <MenuItem label="Duplicate" />
                <MenuItem label="Remove" />
            </MenuList>
        </Menu>
    </Story>
</Canvas>

### `<SubMenu>`

You may nest the `<SubMenu>` component within `<Menu>` to create submenus.

<Canvas>
    <Story
        name="SubMenu Story"
        parameters={{
            docs: { source: { type: 'code' } },
        }}
    >
        <Menu>
            <MenuButton as={Button} variant="secondary" endIcon={<ArrowDown />}>
                With SubMenu
            </MenuButton>
            <MenuList aria-label="With SubMenu">
                <MenuItem
                    as="a"
                    href="https://github.com/Doist/reactist"
                    target="_blank"
                    rel="noreferrer noopener"
                    label="Reactist on Github"
                />
                <MenuItem label="About Reactist…" />
                <MenuItem label="Check for updates…" />
                <hr />
                <SubMenu>
                    <SubMenuItem label="Preferences" />
                    <SubMenuList>
                        <MenuItem label="Settings" />
                        <MenuItem label="Extensions" />
                        <hr />
                        <MenuItem label="Notifications" />
                    </SubMenuList>
                </SubMenu>
            </MenuList>
        </Menu>
    </Story>
</Canvas>

### `<ContextMenuTrigger>`

Using the `<ContextMenuTrigger>` component, an element can be defined as the right-click context menu trigger
for the menu.

In the demo below, right click on the Settings button, or click on the more button:

<Canvas>
    <Story
        name="ContextMenuTrigger Story"
        parameters={{
            docs: { source: { type: 'code' } },
        }}
    >
        <Stack space="small">
            <Menu>
                <Inline space="xsmall">
                    <ContextMenuTrigger as={Button} variant="primary" width="xsmall">
                        Settings
                    </ContextMenuTrigger>
                    <MenuButton
                        as={Button}
                        variant="secondary"
                        icon={<ArrowDown />}
                        aria-label="More"
                    />
                </Inline>
                <MenuList aria-label="Settings menu">
                    <MenuItem label="Account" />
                    <MenuItem label="General" />
                    <MenuItem label="Advanced" />
                </MenuList>
            </Menu>
        </Stack>
    </Story>
</Canvas>

### `<IconMenuItem />`

The `IconMenuItem` component allows you to add icon-only menu items. These menu items do not show
the label visually, although the label is still used to label it for screen readers, and to be shown
as a tooltip.

<Canvas>
    <Story
        name="IconMenuItem Story"
        parameters={{
            docs: { source: { type: 'code' } },
        }}
    >
        <Stack space="small">
            <Menu>
                <Inline space="xsmall">
                    <MenuButton as={Button} variant="secondary">
                        Menu with some icon-only items
                    </MenuButton>
                </Inline>
                <MenuList aria-label="Settings menu">
                    <MenuItem label="Account" />
                    <MenuItem label="General" />
                    <MenuItem label="Advanced" />
                    <hr />
                    <IconsMenuGroup
                        label="Icon-only options"
                        info={
                            <IconMenuItem
                                label="Help about icon-only options"
                                icon="ℹ️"
                                as="a"
                                href="http://doist.github.io/reactist/?path=/docs/design-system-menu--icon-menu-item-story"
                                target="_blank"
                                rel="noreferrer noopener"
                            />
                        }
                    >
                        <IconMenuItem label="Leave" icon={<LeaveIcon />} />
                        <IconMenuItem label="Priority" icon={<FlagIcon />} />
                    </IconsMenuGroup>
                </MenuList>
            </Menu>
        </Stack>
    </Story>
</Canvas>

### Open menu programmatically

You can pass a ref to the parent `Menu` component to have access to a `open` function that allows
you to open the menu programmatically.

export function OpenMenuWithKeyboard() {
    const menuRef = React.useRef(null)
    React.useEffect(() => {
        function handleKeyDown(event) {
            if (event.key === '$' && event.ctrlKey && event.shiftKey && menuRef.current) {
                event.preventDefault()
                event.stopPropagation()
                menuRef.current.open()
            }
        }
        window.addEventListener('keydown', handleKeyDown)
        return () => window.removeEventListener('keydown', handleKeyDown)
    }, [])
    return (
        <Stack space="medium">
            <Text>
                You can open the menu by pressing <code>Ctrl + Shift + $</code>
            </Text>
            <Menu ref={menuRef}>
                <Inline space="xsmall">
                    <MenuButton>Menu</MenuButton>
                </Inline>
                <MenuList aria-label="Settings menu">
                    <MenuItem label="Account" />
                    <MenuItem label="General" />
                    <MenuItem label="Advanced" />
                    <hr />
                    <MenuItem label="Logout" />
                </MenuList>
            </Menu>
        </Stack>
    )
}

<Canvas>
    <Story
        name="Open Programmatically Story"
        parameters={{
            docs: { source: { type: 'dynamic' } },
        }}
    >
        {OpenMenuWithKeyboard.bind({})}
    </Story>
</Canvas>

### Extra Features

You may also use `<MenuGroup>` to group menu items, `disable` a menu item, or
return `false` from `onSelect` to prevent the menu from closing when an item is selected. Moreover,
you can achieve richer menu items with icons, shortcut info, description, etc.

<Canvas>
    <Story
        name="Extra Features Story"
        parameters={{
            docs: { source: { type: 'code' } },
        }}
    >
        <Menu>
            <MenuButton as={Button} variant="tertiary" endIcon={<ArrowDown />}>
                With extra features
            </MenuButton>
            <MenuList aria-label="Menu with extra features">
                <MenuItem
                    label="Settings"
                    icon="⚙️"
                    shortcut={<KeyboardShortcut>O then S</KeyboardShortcut>}
                >
                    <Box display="flex" alignItems="center" gap="small">
                        <Avatar user={{ name: 'Jane Doe', email: 'jane.doe@example.com' }} />
                        <div>
                            <Text weight="semibold">Jane Doe</Text>
                            <Text tone="secondary">jane.doe@example.com</Text>
                        </div>
                    </Box>
                </MenuItem>
                <hr />
                <MenuItem icon="✏" label="Edit" />
                <MenuItem
                    icon="👯‍♀️️"
                    label="Duplicate"
                    shortcut={<KeyboardShortcut>Cmd + D</KeyboardShortcut>}
                />
                <MenuItem
                    onSelect={() => {
                        return false // This prevents the menu from closing
                    }}
                    icon="👀"
                    label="This will not close the menu"
                    shortcut={<KeyboardShortcut>Cmd + S</KeyboardShortcut>}
                />
                <hr />
                <MenuGroup label="Dangerous options">
                    <MenuItem label="Remove first" />
                    <MenuItem label="Remove completed" />
                    <MenuItem disabled label="Remove all (disabled)" />
                </MenuGroup>
                <hr />
                <MenuItem
                    label="Logout"
                    description="When you logout, all changes will be saved"
                    icon={<LeaveIcon />}
                    shortcut={<KeyboardShortcut>Cmd + X</KeyboardShortcut>}
                />
            </MenuList>
        </Menu>
    </Story>
</Canvas>
