import { Meta, Story, Canvas, ArgsTable, Description } from '@storybook/addon-docs'
import KeyboardShortcut from '../components/keyboard-shortcut'
import { Button } from '../button'
import { Inline } from '../inline'
import { Stack } from '../stack'
import { Columns, Column } from '../columns'
import { ContextMenuTrigger, Menu, MenuButton, MenuList, MenuItem, MenuGroup, SubMenu } from '.'
import { ButtonLink } from '../button-link'
import { Text } from '../text'
import { Box } from '../box'
import { Avatar } from '../avatar'

<Meta
    title="Design system/Menu"
    component={Menu}
    parameters={{
        badges: ['accessible'],
    }}
/>

export function ArrowDown() {
    return (
        <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            viewBox="0 0 16 16"
        >
            <path
                fillRule="evenodd"
                d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"
            />
        </svg>
    )
}

export function ArrowRight() {
    return (
        <svg width="24" height="24">
            <path
                d="M14.243 12L9.646 7.404a.5.5 0 1 1 .708-.707l4.95 4.95a.5.5 0 0 1 0 .707l-4.95 4.95a.5.5 0 0 1-.708-.708L14.243 12z"
                fill="currentColor"
                fillRule="evenodd"
            />
        </svg>
    )
}

export function LeaveIcon() {
    return (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24">
            <g fill="none" fillRule="evenodd">
                <path
                    stroke="currentColor"
                    d="M6.5 8.3V5.63c0-1.17.9-2.13 2-2.13h7c1.1 0 2 .95 2 2.13v11.74c0 1.17-.9 2.13-2 2.13h-7c-1.1 0-2-.95-2-2.13V14.7"
                />
                <path
                    fill="currentColor"
                    d="M12.8 11l-2.15-2.15a.5.5 0 1 1 .7-.7L14 10.79a1 1 0 0 1 0 1.42l-2.65 2.64a.5.5 0 0 1-.7-.7L12.79 12H4.5a.5.5 0 0 1 0-1h8.3z"
                />
            </g>
        </svg>
    )
}

# Menu

A set of components that provide the means to construct a menu that can be triggered
via an element or as a context menu.

<Canvas>
    <Story
        name="Simple Menu Story"
        parameters={{
            docs: { source: { type: 'code' } },
        }}
    >
        <Menu>
            <MenuButton as={Button} variant="primary" endIcon={<ArrowDown />}>
                Simple menu
            </MenuButton>
            <MenuList aria-label="Simple menu">
                <MenuItem label="Edit" />
                <MenuItem label="Copy" />
                <MenuItem label="Paste" />
                <MenuItem label="Duplicate" />
                <MenuItem label="Remove" />
            </MenuList>
        </Menu>
    </Story>
</Canvas>

### `tooltip`

The `tooltip` prop allows a tooltip to be shown over the menu button.

<Canvas>
    <Story
        name="Tooltip Story"
        parameters={{
            docs: { source: { type: 'code' } },
        }}
    >
        <Menu>
            <MenuButton as={Button} variant="primary" tooltip="I have a tooltip">
                Focus on or hover over me
            </MenuButton>
            <MenuList aria-label="Tooltip menu">
                <MenuItem label="Edit" />
                <MenuItem label="Copy" />
                <MenuItem label="Paste" />
                <MenuItem label="Duplicate" />
                <MenuItem label="Remove" />
            </MenuList>
        </Menu>
    </Story>
</Canvas>

### `modal`

By default, interaction with elements below the menu is disallowed when the menu is open. This behaviour can
be changed by passing `modal={false}` to `<MenuList>`

<Canvas>
    <Story
        name="Outside Interaction Story"
        parameters={{
            docs: { source: { type: 'code' } },
        }}
    >
        <Menu>
            <MenuButton as={Button} variant="primary">
                Menu
            </MenuButton>
            <MenuList aria-label="Outside interaction menu" modal={false}>
                <MenuItem label="Edit" />
                <MenuItem label="Copy" />
                <MenuItem label="Paste" />
                <MenuItem label="Duplicate" />
                <MenuItem label="Remove" />
            </MenuList>
        </Menu>
    </Story>
</Canvas>

### `<SubMenu>`

You may nest the `<SubMenu>` component within `<Menu>` to create submenus.

<Canvas>
    <Story
        name="SubMenu Story"
        parameters={{
            docs: { source: { type: 'code' } },
        }}
    >
        <Menu>
            <MenuButton as={Button} variant="secondary" endIcon={<ArrowDown />}>
                With SubMenu
            </MenuButton>
            <MenuList aria-label="With SubMenu">
                <MenuItem
                    as="a"
                    href="https://github.com/Doist/reactist"
                    target="_blank"
                    rel="noreferrer noopener"
                    label="Reactist on Github"
                />
                <MenuItem label="About Reactist…" />
                <MenuItem label="Check for updates…" />
                <hr />
                <SubMenu>
                    <MenuButton>
                        Preferences
                        <ArrowRight />
                    </MenuButton>
                    <MenuList>
                        <MenuItem label="Settings" />
                        <MenuItem label="Extensions" />
                        <hr />
                        <MenuItem label="Notifications" />
                    </MenuList>
                </SubMenu>
            </MenuList>
        </Menu>
    </Story>
</Canvas>

### `<ContextMenuTrigger>`

Using the `<ContextMenuTrigger>` component, an element can be defined as the right-click context menu trigger
for the menu.

In the demo below, right click on the Settings button, or click on the more button:

<Canvas>
    <Story
        name="ContextMenuTrigger Story"
        parameters={{
            docs: { source: { type: 'code' } },
        }}
    >
        <Stack space="small">
            <Menu>
                <Inline space="xsmall">
                    <ContextMenuTrigger as={Button} variant="primary" width="xsmall">
                        Settings
                    </ContextMenuTrigger>
                    <MenuButton
                        as={Button}
                        variant="secondary"
                        icon={<ArrowDown />}
                        aria-label="More"
                    />
                </Inline>
                <MenuList aria-label="Settings menu">
                    <MenuItem label="Account" />
                    <MenuItem label="General" />
                    <MenuItem label="Advanced" />
                </MenuList>
            </Menu>
        </Stack>
    </Story>
</Canvas>

### Open menu programmatically

You can pass a ref to the parent `Menu` component to have access to a `open` function that allows
you to open the menu programmatically.

export function OpenMenuWithKeyboard() {
    const menuRef = React.useRef(null)
    React.useEffect(() => {
        function handleKeyDown(event) {
            if (event.key === '$' && event.ctrlKey && event.shiftKey && menuRef.current) {
                event.preventDefault()
                event.stopPropagation()
                menuRef.current.open()
            }
        }
        window.addEventListener('keydown', handleKeyDown)
        return () => window.removeEventListener('keydown', handleKeyDown)
    }, [])
    return (
        <Stack space="medium">
            <Text>
                You can open the menu by pressing <code>Ctrl + Shift + $</code>
            </Text>
            <Menu ref={menuRef}>
                <Inline space="xsmall">
                    <MenuButton>Menu</MenuButton>
                </Inline>
                <MenuList aria-label="Settings menu">
                    <MenuItem label="Account" />
                    <MenuItem label="General" />
                    <MenuItem label="Advanced" />
                    <hr />
                    <MenuItem label="Logout" />
                </MenuList>
            </Menu>
        </Stack>
    )
}

<Canvas>
    <Story
        name="Open Programmatically Story"
        parameters={{
            docs: { source: { type: 'dynamic' } },
        }}
    >
        {OpenMenuWithKeyboard.bind({})}
    </Story>
</Canvas>

### Extra Features

You may also use `<MenuGroup>` to group menu items, `disable` a menu item, or
return `false` from `onSelect` to prevent the menu from closing when an item is selected. Moreover,
you can achieve richer menu items with icons, shortcut info, description, etc.

<Canvas>
    <Story
        name="Extra Features Story"
        parameters={{
            docs: { source: { type: 'code' } },
        }}
    >
        <Menu>
            <MenuButton as={Button} variant="tertiary" endIcon={<ArrowDown />}>
                With extra features
            </MenuButton>
            <MenuList aria-label="Menu with extra features">
                <MenuItem
                    label="Settings"
                    icon="⚙️"
                    shortcut={<KeyboardShortcut>O then S</KeyboardShortcut>}
                >
                    <Box display="flex" alignItems="center" gap="small">
                        <Avatar user={{ name: 'Jane Doe', email: 'jane.doe@example.com' }} />
                        <Stack space="small">
                            <Text weight="semibold">Jane Doe</Text>
                            <Text tone="secondary">jane.doe@example.com</Text>
                        </Stack>
                    </Box>
                </MenuItem>
                <hr />
                <MenuItem icon="✏" label="Edit" />
                <MenuItem
                    icon="👯‍♀️️"
                    label="Duplicate"
                    shortcut={<KeyboardShortcut>Cmd + D</KeyboardShortcut>}
                />
                <MenuItem
                    onSelect={() => {
                        return false // This prevents the menu from closing
                    }}
                    icon="👀"
                    label="This will not close the menu"
                    shortcut={<KeyboardShortcut>Cmd + S</KeyboardShortcut>}
                />
                <hr />
                <MenuGroup label="Dangerous options">
                    <MenuItem label="Remove first" />
                    <MenuItem label="Remove completed" />
                    <MenuItem disabled label="Remove all (disabled)" />
                </MenuGroup>
                <hr />
                <MenuItem
                    label="Logout"
                    description="When you logout, all changes will be saved"
                    icon={<LeaveIcon />}
                    shortcut={<KeyboardShortcut>Cmd + X</KeyboardShortcut>}
                />
            </MenuList>
        </Menu>
    </Story>
</Canvas>
