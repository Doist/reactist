import { useEffect, useState } from 'react'
import { Meta, Story, Canvas, ArgsTable, Description } from '@storybook/addon-docs'
import { Box } from '../box'
import { Inline } from '../inline'
import { Stack } from '../stack'
import { Text } from '../text'
import { Heading } from '../heading'
import { Button } from './button'

<Meta
    title="Design system/Button"
    component={Button}
    parameters={{
        badges: ['accessible'],
    }}
/>

export function Icon() {
    return (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <path
                fill="currentColor"
                d="M6 6.653a1 1 0 011.464-.886l10.246 5.37a1 1 0 01-.002 1.773L7.46 18.24a1 1 0 01-1.461-.887V13l6.96-.674a.328.328 0 000-.652L6 11V6.653z"
            />
        </svg>
    )
}

export function LoadingButton({ disabledWhenLoading = false, ...props }) {
    const [loading, setLoading] = useState(false)
    useEffect(() => {
        if (!loading) return undefined
        const timeout = setTimeout(() => setLoading(false), 3000)
        return () => clearTimeout(timeout)
    }, [loading])
    return (
        <Button
            {...props}
            loading={loading}
            disabled={disabledWhenLoading ? loading : props.disabled}
            onClick={() => setLoading(true)}
        />
    )
}

# Button

<Description of={Button} />
<ArgsTable of={Button} />

## Main demo

<Canvas>
    <Story
        name="Main demo"
        parameters={{
            docs: { source: { type: 'code' } },
            chromatic: { disableSnapshot: false },
        }}
    >
        <Stack space="xxlarge">
            <Stack space="large">
                <pre>tone="normal"</pre>
                <Inline space="large">
                    <Box>
                        <LoadingButton variant="primary">Primary</LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="secondary">Secondary</LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="tertiary">Tertiary</LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="quaternary">Quaternary</LoadingButton>
                    </Box>
                </Inline>
                <Inline space="large">
                    <Box>
                        <LoadingButton variant="primary" disabledWhenLoading>
                            Primary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="secondary" disabledWhenLoading>
                            Secondary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="tertiary" disabledWhenLoading>
                            Tertiary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="quaternary" disabledWhenLoading>
                            Quaternary
                        </LoadingButton>
                    </Box>
                </Inline>
                <Inline space="large">
                    <Box>
                        <LoadingButton variant="primary" disabled>
                            Primary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="secondary" disabled>
                            Secondary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="tertiary" disabled>
                            Tertiary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="quaternary" disabled>
                            Quaternary
                        </LoadingButton>
                    </Box>
                </Inline>
            </Stack>
            <Stack space="large">
                <pre>tone="destructive"</pre>
                <Inline space="large">
                    <Box>
                        <LoadingButton variant="primary" tone="destructive">
                            Primary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="secondary" tone="destructive">
                            Secondary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="tertiary" tone="destructive">
                            Tertiary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="quaternary" tone="destructive">
                            Quaternary
                        </LoadingButton>
                    </Box>
                </Inline>
                <Inline space="large">
                    <Box>
                        <LoadingButton variant="primary" tone="destructive" disabledWhenLoading>
                            Primary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="secondary" tone="destructive" disabledWhenLoading>
                            Secondary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="tertiary" tone="destructive" disabledWhenLoading>
                            Tertiary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="quaternary" tone="destructive" disabledWhenLoading>
                            Quaternary
                        </LoadingButton>
                    </Box>
                </Inline>
                <Inline space="large">
                    <Box>
                        <LoadingButton variant="primary" tone="destructive" disabled>
                            Primary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="secondary" tone="destructive" disabled>
                            Secondary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="tertiary" tone="destructive" disabled>
                            Tertiary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="quaternary" tone="destructive" disabled>
                            Quaternary
                        </LoadingButton>
                    </Box>
                </Inline>
            </Stack>
        </Stack>
    </Story>
</Canvas>

## With label and icon

To have icons rendered before or after the label, you can use the `startIcon` or `endIcon` prop for
this purpose.

Nothing prevents you from passing both a `startIcon` and an `endIcon` at the same time. However,
this is discouraged, and not guaranteed to be supported in the future.

<Canvas>
    <Story
        name="With label and icon"
        parameters={{
            docs: { source: { type: 'code' } },
            chromatic: { disableSnapshot: false },
        }}
    >
        <Stack space="xxlarge">
            <Stack space="large">
                <Text>Icon before the label</Text>
                <Inline space="large">
                    <Box>
                        <LoadingButton variant="primary" startIcon={<Icon />}>
                            Primary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="secondary" startIcon={<Icon />}>
                            Secondary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="tertiary" startIcon={<Icon />}>
                            Tertiary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="quaternary" startIcon={<Icon />}>
                            Quaternary
                        </LoadingButton>
                    </Box>
                </Inline>
            </Stack>
            <Stack space="large">
                <Text>Icon after the label</Text>
                <Inline space="large">
                    <Box>
                        <LoadingButton variant="primary" endIcon={<Icon />}>
                            Primary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="secondary" endIcon={<Icon />}>
                            Secondary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="tertiary" endIcon={<Icon />}>
                            Tertiary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="quaternary" endIcon={<Icon />}>
                            Quaternary
                        </LoadingButton>
                    </Box>
                </Inline>
            </Stack>
        </Stack>
    </Story>
</Canvas>

## With different size

Buttons have a default `normal` size, but they can also be larger or smaller. Use the `size` prop
for this purpose.

<Canvas>
    <Story
        name="With different size"
        parameters={{
            docs: { source: { type: 'code' } },
            chromatic: { disableSnapshot: false },
        }}
    >
        <Stack space="xxlarge">
            <Stack space="large">
                <pre>size="small"</pre>
                <Inline space="large">
                    <Box>
                        <LoadingButton variant="primary" size="small">
                            Primary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="secondary" size="small">
                            Secondary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="tertiary" size="small">
                            Tertiary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="quaternary" size="small">
                            Quaternary
                        </LoadingButton>
                    </Box>
                </Inline>
                <Inline space="large">
                    <Box>
                        <LoadingButton variant="primary" size="small" disabled>
                            Primary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="secondary" size="small" disabled>
                            Secondary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="tertiary" size="small" disabled>
                            Tertiary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="quaternary" size="small" disabled>
                            Quaternary
                        </LoadingButton>
                    </Box>
                </Inline>
            </Stack>
            <Stack space="large">
                <pre>size="normal"</pre>
                <Inline space="large">
                    <Box>
                        <LoadingButton variant="primary" size="normal">
                            Primary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="secondary" size="normal">
                            Secondary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="tertiary" size="normal">
                            Tertiary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="quaternary" size="normal">
                            Quaternary
                        </LoadingButton>
                    </Box>
                </Inline>
                <Inline space="large">
                    <Box>
                        <LoadingButton variant="primary" size="normal" disabled>
                            Primary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="secondary" size="normal" disabled>
                            Secondary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="tertiary" size="normal" disabled>
                            Tertiary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="quaternary" size="normal" disabled>
                            Quaternary
                        </LoadingButton>
                    </Box>
                </Inline>
            </Stack>
            <Stack space="large">
                <pre>size="large"</pre>
                <Inline space="large">
                    <Box>
                        <LoadingButton variant="primary" size="large">
                            Primary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="secondary" size="large">
                            Secondary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="tertiary" size="large">
                            Tertiary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="quaternary" size="large">
                            Quaternary
                        </LoadingButton>
                    </Box>
                </Inline>
                <Inline space="large">
                    <Box>
                        <LoadingButton variant="primary" size="large" disabled>
                            Primary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="secondary" size="large" disabled>
                            Secondary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="tertiary" size="large" disabled>
                            Tertiary
                        </LoadingButton>
                    </Box>
                    <Box>
                        <LoadingButton variant="quaternary" size="large" disabled>
                            Quaternary
                        </LoadingButton>
                    </Box>
                </Inline>
            </Stack>
        </Stack>
    </Story>
</Canvas>

## Customized colors

Though probably not the final official way to do it, this is a way to achieve one-off alternative
styles for buttons.

```jsx
<Button
    variant="primary"
    style={{
        '--reactist-btn-idle-tint': '#eee',
        '--reactist-btn-idle-fill': '#666',
        '--reactist-btn-hover-tint': '#fff',
        '--reactist-btn-hover-fill': '#777',
        '--reactist-btn-disabled-tint': '#fff',
        '--reactist-btn-disabled-fill': '#ccc',
    }}
>
    Click me
</Button>
```

And here's how that look like:

<Canvas>
    <Story parameters={{ docs: { source: { type: 'code' } } }} name="Customized colors">
        <Inline space="large">
            <Box>
                <LoadingButton
                    variant="primary"
                    style={{
                        '--reactist-btn-idle-tint': '#eee',
                        '--reactist-btn-idle-fill': '#666',
                        '--reactist-btn-hover-tint': '#fff',
                        '--reactist-btn-hover-fill': '#777',
                        '--reactist-btn-disabled-tint': '#fff',
                        '--reactist-btn-disabled-fill': '#ccc',
                    }}
                >
                    Enabled
                </LoadingButton>
            </Box>
            <Box>
                <LoadingButton
                    variant="primary"
                    disabled
                    style={{
                        '--reactist-btn-idle-tint': '#eee',
                        '--reactist-btn-idle-fill': '#666',
                        '--reactist-btn-hover-tint': '#fff',
                        '--reactist-btn-hover-fill': '#777',
                        '--reactist-btn-disabled-tint': '#fff',
                        '--reactist-btn-disabled-fill': '#ccc',
                    }}
                >
                    Disabled
                </LoadingButton>
            </Box>
        </Inline>
    </Story>
</Canvas>

## Full-width

Buttons can be set to take the full width of their container by using the `width` prop.

<Canvas>
    <Story
        name="Full-width"
        parameters={{
            docs: { source: { type: 'code' } },
            chromatic: { disableSnapshot: false },
        }}
        argTypes={{
            label: {
                control: { type: 'select' },
                options: [
                    'OK',
                    'Submit',
                    'Mark as done',
                    'Yes, cancel my subscription',
                    'Click me <em>now</em>',
                    'If you click me now, youʼll take away the biggest part of me',
                ],
                defaultValue: 'Submit',
            },
            variant: {
                options: ['primary', 'secondary', 'tertiary', 'quaternary'],
                control: { type: 'select' },
                defaultValue: 'primary',
            },
            tone: {
                options: ['normal', 'destructive'],
                control: { type: 'inline-radio' },
                defaultValue: 'normal',
            },
            size: {
                options: ['small', 'normal', 'large'],
                control: { type: 'inline-radio' },
                defaultValue: 'normal',
            },
            shape: {
                options: ['normal', 'rounded'],
                control: { type: 'inline-radio' },
                defaultValue: 'normal',
            },
            width: {
                options: ['none', 'xsmall', 'small', 'medium', 'large', 'xlarge', 'full'],
                control: { type: 'select' },
                defaultValue: 'full',
            },
            align: { control: false },
            disabled: { control: false },
            startIcon: { control: false },
            endIcon: { control: false },
            icon: { control: false },
            tooltip: { control: false },
            exceptionallySetClassName: { control: false },
        }}
    >
        {FullWidthTemplate.bind({})}
    </Story>
</Canvas>

export function FullWidthTemplate({ label, ...otherProps }) {
    if (label === 'Click me <em>now</em>') {
        label = (
            <>
                Click me <em>now</em>
            </>
        )
    }
    const props = {
        ...otherProps,
        startIcon: <Icon />,
        endIcon: <Icon />,
    }
    return (
        <Stack space="medium">
            <Heading level="2">Full-width buttons and label alignment</Heading>
            <Text>
                When buttons have `width` other than the default `auto` they can also customize how
                the label is aligned horizontally.
            </Text>
            <Box width="full" padding="medium" style={{ border: '1px solid gray' }}>
                <Stack space="medium">
                    <LoadingButton {...props} align="start">
                        {label}
                    </LoadingButton>
                    <LoadingButton {...props} align="center">
                        {label}
                    </LoadingButton>
                    <LoadingButton {...props} align="end">
                        {label}
                    </LoadingButton>
                </Stack>
            </Box>
        </Stack>
    )
}

## Playground

<Canvas>
    <Story
        name="Playground"
        parameters={{ docs: { source: { type: 'code' } } }}
        argTypes={{
            label: {
                control: { type: 'select' },
                options: [
                    'OK',
                    'Submit',
                    'Mark as done',
                    'Yes, cancel my subscription',
                    'Click me <em>now</em>',
                    'If you click me now, youʼll take away the biggest part of me',
                ],
                defaultValue: 'Submit',
            },
            variant: {
                options: ['primary', 'secondary', 'tertiary', 'quaternary'],
                control: { type: 'select' },
                defaultValue: 'primary',
            },
            tone: {
                options: ['normal', 'destructive'],
                control: { type: 'inline-radio' },
                defaultValue: 'normal',
            },
            size: {
                options: ['small', 'normal', 'large'],
                control: { type: 'inline-radio' },
                defaultValue: 'normal',
            },
            shape: {
                options: ['normal', 'rounded'],
                control: { type: 'inline-radio' },
                defaultValue: 'normal',
            },
            disabled: { control: false },
            startIcon: { control: false },
            endIcon: { control: false },
            icon: { control: false },
            tooltip: { control: false },
            exceptionallySetClassName: { control: false },
        }}
    >
        {PlaygroundTemplate.bind({})}
    </Story>
</Canvas>

export function PlaygroundTemplate({ label, ...props }) {
    let textLabel = label
    if (label === 'Click me <em>now</em>') {
        label = (
            <>
                Click me <em>now</em>
            </>
        )
        textLabel = 'Click me now'
    }
    return (
        <Stack space="large">
            <Heading level="2">Click on the buttons to see the loading state</Heading>
            <Inline space="large">
                <Box>
                    <Stack space="large">
                        <Box maxWidth="xsmall">
                            <LoadingButton {...props}>{label}</LoadingButton>
                        </Box>
                        <Box maxWidth="xsmall">
                            <LoadingButton {...props} disabled>
                                {label}
                            </LoadingButton>
                        </Box>
                    </Stack>
                </Box>
                <Box>
                    <Stack space="large">
                        <Box maxWidth="xsmall">
                            <LoadingButton {...props} startIcon={<Icon />}>
                                {label}
                            </LoadingButton>
                        </Box>
                        <Box maxWidth="xsmall">
                            <LoadingButton {...props} startIcon={<Icon />} disabled>
                                {label}
                            </LoadingButton>
                        </Box>
                    </Stack>
                </Box>
                <Box>
                    <Stack space="large">
                        <Box maxWidth="xsmall">
                            <LoadingButton {...props} endIcon={<Icon />}>
                                {label}
                            </LoadingButton>
                        </Box>
                        <Box maxWidth="xsmall">
                            <LoadingButton {...props} endIcon={<Icon />} disabled>
                                {label}
                            </LoadingButton>
                        </Box>
                    </Stack>
                </Box>
            </Inline>
        </Stack>
    )
}

## Dark mode

export function DarkModeTemplate(props) {
    return (
        <Box
            padding="xlarge"
            style={{
                backgroundColor: 'rgb(31, 31, 31)',
                '--reactist-content-primary': 'rgba(255, 255, 255, 0.88)',
                // variant="primary"
                '--reactist-actionable-primary-idle-tint': '#eceeee',
                '--reactist-actionable-primary-idle-fill': '#008099',
                '--reactist-actionable-primary-hover-tint': '#eceeee',
                '--reactist-actionable-primary-hover-fill': '#1f8fa5',
                '--reactist-actionable-primary-disabled-tint': '#767777',
                '--reactist-actionable-primary-disabled-fill': '#00404c',
                // variant="secondary"
                '--reactist-actionable-secondary-idle-tint': '#eceeee',
                '--reactist-actionable-secondary-idle-fill': '#283233',
                '--reactist-actionable-secondary-hover-tint': '#eceeee',
                '--reactist-actionable-secondary-hover-fill': '#31393b',
                '--reactist-actionable-secondary-disabled-tint': '#767777',
                '--reactist-actionable-secondary-disabled-fill': '#283233',
                // variant="tertiary"
                '--reactist-actionable-tertiary-idle-tint': '#22a5bf',
                '--reactist-actionable-tertiary-hover-tint': '#22a5bf',
                '--reactist-actionable-tertiary-hover-fill': '#283233',
                '--reactist-actionable-tertiary-disabled-tint': '#11525f',
                // variant="quaternary"
                '--reactist-actionable-quaternary-idle-tint': '#8fa0a3',
                '--reactist-actionable-quaternary-hover-tint': '#eceeee',
                '--reactist-actionable-quaternary-hover-fill': '#283233',
                '--reactist-actionable-quaternary-disabled-tint': '#444d4f',
                // colour for the desctructive tone (used in certain ways by all variants)
                '--reactist-actionable-primary-destructive-idle-tint': '#fff',
                '--reactist-actionable-primary-destructive-idle-fill': '#d26160',
                '--reactist-actionable-primary-destructive-hover-tint': '#fff',
                '--reactist-actionable-primary-destructive-hover-fill': '#e98786',
                '--reactist-actionable-primary-destructive-disabled-tint': '#767777',
                '--reactist-actionable-primary-destructive-disabled-fill': '#7f2c24',
                /* secondary destructive button colors (no fill, as these are transparent and bordered) */
                '--reactist-actionable-secondary-destructive-idle-tint': '#f68584',
                '--reactist-actionable-secondary-destructive-hover-tint': '#eFa9a9',
                '--reactist-actionable-secondary-destructive-disabled-tint': '#8a5853',
            }}
        >
            <PlaygroundTemplate {...props} />
        </Box>
    )
}

Even though Reactist does not yet owns the concept of dark mode, and leaves it for apps to set it
up, here's a demo on how easily you can set it up by manipulating color variables only.

<Canvas>
    <Story
        name="Dark mode"
        parameters={{ docs: { source: { type: 'dynamic' } } }}
        argTypes={{
            label: {
                control: { type: 'select' },
                options: [
                    'Submit',
                    'Mark as done',
                    'Yes, cancel my subscription',
                    'Click me <em>now</em>',
                ],
                defaultValue: 'Submit',
            },
            variant: {
                options: ['primary', 'secondary', 'tertiary', 'quaternary'],
                control: { type: 'select' },
                defaultValue: 'primary',
            },
            tone: {
                options: ['normal', 'destructive'],
                control: { type: 'inline-radio' },
                defaultValue: 'normal',
            },
            size: {
                options: ['small', 'normal', 'large'],
                control: { type: 'inline-radio' },
                defaultValue: 'normal',
            },
            disabled: { control: false },
            startIcon: { control: false },
            endIcon: { control: false },
            icon: { control: false },
            tooltip: { control: false },
            exceptionallySetClassName: { control: false },
        }}
    >
        {DarkModeTemplate.bind({})}
    </Story>
</Canvas>

## Colors

The following CSS custom properties are available to customize the button-like element appearance.

```
--reactist-actionable-primary-idle-tint
--reactist-actionable-primary-idle-fill
--reactist-actionable-primary-hover-tint
--reactist-actionable-primary-hover-fill
--reactist-actionable-primary-disabled-tint
--reactist-actionable-primary-disabled-fill

--reactist-actionable-secondary-idle-tint
--reactist-actionable-secondary-idle-fill
--reactist-actionable-secondary-hover-tint
--reactist-actionable-secondary-hover-fill
--reactist-actionable-secondary-disabled-tint
--reactist-actionable-secondary-disabled-fill

--reactist-actionable-tertiary-idle-tint
--reactist-actionable-tertiary-idle-fill
--reactist-actionable-tertiary-hover-tint
--reactist-actionable-tertiary-hover-fill
--reactist-actionable-tertiary-disabled-tint
--reactist-actionable-tertiary-disabled-fill

--reactist-actionable-destructive-idle-tint
--reactist-actionable-destructive-idle-fill
--reactist-actionable-destructive-hover-tint
--reactist-actionable-destructive-hover-fill
--reactist-actionable-destructive-disabled-tint
--reactist-actionable-destructive-disabled-fill
```
